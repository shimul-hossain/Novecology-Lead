@extends('layouts.master')


{{-- Title part  --}}
@section('title')
    Tickets
@endsection

@section('bodyBg')
secondary-bg
@endsection

@section('ticketing')
active
@endsection

@push('plugins-link')
    <link rel="stylesheet" href="{{ asset('crm_assets/assets/plugins/tagify/css/tagify.css') }}">
    <link rel="stylesheet" href="{{ asset('crm_assets/assets/plugins/fancybox/jquery.fancybox.min.css') }}">
    <style>
        .form-control {
            border-color: #dddddd;
        }
        .ticketFilterbtn.active{
            background-color: var(--active-bg);
        }
    </style>
@endpush


{{-- Main content part  --}}
@section('content')
    <!-- Ticketing Section -->
    <section class="ticket-section">
        <div class="container-fluid">
            <div class="ticket-section-container">
                <div class="row">
                    <div class="col-12 d-flex align-item-center flex-wrap py-3">
                        <h1 class="dashboard-title mr-auto mb-1">{{ __('Ticket Analytics') }}</h1>
                        <div class="ml-auto mb-1">
                            @if (checkAction(Auth::id(), 'ticketing', 'create') || role() == 's_admin')
                                <button type="button" class="ticket-main__chat-card__send-btn" data-toggle="modal" data-target="#createTicketModal">
                                    <i class="bi bi-plus-square-dotted"></i>
                                    <span class="pl-1">{{ __('Create New Ticket') }}</span>
                                </button>
                            @else
                                <button type="button" class="ticket-main__chat-card__send-btn">
                                    <span class="novecologie-icon-lock py-1"></span>
                                    <span class="pl-1">{{ __('Create New Ticket') }}</span>
                                </button>
                            @endif
                        </div>
                    </div>
                    <div class="col-12 mb-3">
                        <form class="bg-white px-3 pt-3 border rounded-lg" action="{{ route('ticket.filter') }}">
                            <div class="row">
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Client</label>
                                        <select name="client" class="select2_select_option custom-select shadow-none form-control">
                                            <option value="" selected>Sélectionnez</option>
                                            @foreach ($projects as $project)
                                                <option {{ request()->client == $project['id'] ? 'selected':'' }} value="{{ $project['id'] }}">{{ $project['Prenom'].' '.$project['Nom'].'-'.$project['tag'].'-'.$project['Code_Postal'] }}</option>
                                            @endforeach
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Code postal</label>
                                        <input type="text" name="code_postal" value="{{ request()->code_postal }}" class="form-control shadow-none">
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">N° de ticket</label>
                                        <input type="text" name="ticket_number" value="{{ request()->ticket_number }}" class="form-control shadow-none">
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label class="form-label" for="ticketTypeFilter"> Type de ticket <span class="text-danger">*</span></label>
                                        <select class="select2_select_option shadow-none form-control" id="ticketTypeFilter" name="ticket_type">
                                            <option {{ request()->ticket_type == 'Administratif' ? 'selected':'' }} value="Administratif">Administratif</option>
                                            <option {{ request()->ticket_type == 'Technique' ? 'selected':'' }} value="Technique">Technique</option>
                                            <option {{ request()->ticket_type == 'Financier' ? 'selected':'' }} value="Financier">Financier</option>
                                        </select>
                                        <div class="invalid-feedback">{{ __('This field in necessary') }}</div>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Type de problème</label>
                                        <select name="ticket_problem" id="ticketProblemFilter" class="select2_select_option custom-select shadow-none form-control">
                                            <option value="" selected>Sélectionnez</option>
                                            @if (request()->ticket_type)
                                                @foreach ($ticket_problems->where('ticket_type', request()->ticket_type) as $ticket_problem)
                                                    <option {{ request()->ticket_problem == $ticket_problem->id ? 'selected':'' }} value="{{ $ticket_problem->id }}">{{ $ticket_problem->name }}</option>
                                                @endforeach
                                            @else
                                                @foreach ($ticket_problems->where('ticket_type', 'Administratif') as $ticket_problem)
                                                    <option {{ request()->ticket_problem == $ticket_problem->id ? 'selected':'' }} value="{{ $ticket_problem->id }}">{{ $ticket_problem->name }}</option>
                                                @endforeach
                                            @endif
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Echéance résolution ticket</label>
                                        <select name="ticket_deadline" class="select2_select_option custom-select shadow-none form-control">
                                            <option value="" selected>Sélectionnez</option>
                                            <option {{ request()->ticket_deadline == '5' ? 'selected':'' }} value="5">Inférieur à 5 jours</option>
                                            <option {{ request()->ticket_deadline == '5-10' ? 'selected':'' }} value="5-10">Entre 5 et 10 jours</option>
                                            <option {{ request()->ticket_deadline == '10-30' ? 'selected':'' }} value="10-30">Entre 10 et 30 jours</option>
                                            <option {{ request()->ticket_deadline == '30-60' ? 'selected':'' }} value="30-60">Entre 30 et 60 jours</option>
                                            <option {{ request()->ticket_deadline == '60' ? 'selected':'' }} value="60">Plus de 60 jours</option>
                                            <option {{ request()->ticket_deadline == 'expired' ? 'selected':'' }} value="expired">Expirée</option>
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">De</label>
                                        <input type="date" name="from" value="{{ request()->from }}" class="flatpickr flatpickr-input form-control shadow-none bg-white" placeholder="Date Mois, Année">
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">a</label>
                                        <input type="date" name="to" value="{{ request()->to }}" class="flatpickr flatpickr-input form-control shadow-none bg-white" placeholder="Date Mois, Année">
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6">
                                    <div class="form-group">
                                        <label class="form-label">Responsable Commercial</label>
                                        <select class="select2_select_option shadow-none form-control" name="commercial_user_id">
                                            <option value="">{{ __('Select') }}</option>
                                            @foreach ($users->whereIn('role', ['sales_manager', 'sales_manager_externe']) as $user)
                                                <option {{ $user->id == request()->commercial_user_id ? 'selected':'' }} value="{{ $user->id }}">{{ $user->name }} ({{ $user->getRegieTelecommercial->name ?? '' }})</option>
                                            @endforeach
                                        </select>
                                    </div>
                                </div>
                                <div class="col-lg-3 col-md-6 ml-auto mt-3 d-flex align-items-center justify-content-end">
                                    <div class="form-group">
                                        <button type="submit" class="ticket-main__chat-card__send-btn">
                                            Valider
                                        </button>
                                        @if (\Request::route()->getName() == 'ticket.filter')
                                            <a href="{{ route('ticketing.index') }}" class="btn btn-sm btn-outline-danger" name="clear" type="submit"><i class="bi bi-x-lg"></i></a>
                                        @endif
                                    </div>
                                </div>
                            </div>
                        </form>
                    </div>
                </div>
                <div class="row">
                    <div class="col-xl-3 col-lg-4 col-md-5">
                        <div class="ticket-card-list-wrapper">
                            <div class="row">
                                <div class="col-12">
                                    <div class="ticket-card-searchbar-wrapper form-group mb-0">
                                        <input type="search" class="form-control shadow-none bg-white ticket-card-searchbar" placeholder="Rechercher tickets">
                                    </div>
                                </div>
                                <div class="col-auto d-flex flex-column pt-3 pr-0">
                                    <button type="button" data-toggle="tooltip" title="Ouvert" style="--active-bg: green;" data-filter-type="open" class="ticketFilterbtn ticketFilterbtnType btn-icon primary-btn--primary rounded border-0">
                                        <i class="bi bi-eye-fill"></i>
                                    </button>
                                    <button type="button" data-toggle="tooltip" title="Cloturé" style="--active-bg: red;" data-filter-type="closed" class="ticketFilterbtn ticketFilterbtnType btn-icon primary-btn--primary rounded border-0 my-1">
                                        <i class="bi bi-eye-slash-fill"></i>
                                    </button>
                                </div>
                                <div class="col">
                                    <div class="pt-3 d-flex flex-wrap" style="gap: 5px;">
                                        <button type="button" data-toggle="tooltip" title="Administratif" style="--active-bg: green;" data-filter-type="Administratif" class="ticketFilterbtn ticketFilterbtnStatus  btn-icon primary-btn--primary rounded border-0">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="13" height="17" viewBox="0 0 13 17" fill="none">
                                                <path d="M0.71875 8.83328C0.71875 6.45132 0.71875 4.05905 0.71875 1.67709C0.71875 1.40899 0.758847 1.16151 0.939283 0.955284C1.14979 0.718119 1.41042 0.65625 1.70112 0.65625C3.6358 0.65625 5.57048 0.65625 7.49513 0.65625C7.96627 0.65625 8.42738 0.65625 8.89852 0.65625C9.21929 0.65625 9.48995 0.769677 9.71048 1.00684C10.5826 1.91425 11.4547 2.83198 12.3368 3.72908C12.5674 3.96625 12.6676 4.23435 12.6676 4.554C12.6676 5.77076 12.6676 6.98752 12.6676 8.20428C12.6676 10.8028 12.6676 13.4013 12.6676 15.9895C12.6676 16.2576 12.6275 16.5154 12.4371 16.7216C12.2366 16.9381 11.986 17 11.7053 17C10.5425 17 9.37968 17 8.20685 17C6.04161 17 3.88641 17 1.72117 17C1.55076 17 1.38035 16.9897 1.21996 16.9175C0.859089 16.7422 0.71875 16.4329 0.71875 16.041C0.71875 15.1336 0.71875 14.2365 0.71875 13.3291C0.71875 11.8339 0.71875 10.3388 0.71875 8.83328ZM1.3202 8.82297C1.3202 11.2152 1.3202 13.6075 1.3202 15.9998C1.3202 16.3401 1.37032 16.3916 1.6911 16.3916C5.02917 16.3916 8.36723 16.3916 11.7053 16.3916C12.0161 16.3916 12.0662 16.3401 12.0662 16.0101C12.0662 12.2567 12.0662 8.50331 12.0662 4.74992C12.0662 4.50244 12.0662 4.49213 11.8256 4.49213C11.184 4.49213 10.5525 4.49213 9.91097 4.49213C9.66036 4.49213 9.41978 4.45089 9.22932 4.26528C9.00879 4.05905 8.95866 3.78064 8.94864 3.49192C8.94864 2.84229 8.94864 2.20298 8.94864 1.55335C8.94864 1.27494 8.94864 1.27494 8.67799 1.27494C6.36239 1.27494 4.03677 1.27494 1.72117 1.27494C1.68108 1.27494 1.64098 1.27494 1.60088 1.27494C1.4004 1.28525 1.33023 1.35743 1.33023 1.56366C1.33023 1.62553 1.33023 1.69771 1.33023 1.75958C1.3202 4.12092 1.3202 6.47194 1.3202 8.82297ZM9.57014 1.76989C9.54007 1.81114 9.55009 1.8627 9.55009 1.90394C9.55009 2.46077 9.55009 3.00728 9.55009 3.5641C9.55009 3.81157 9.62026 3.87344 9.85082 3.87344C10.3921 3.87344 10.9435 3.87344 11.4848 3.87344C11.5249 3.87344 11.575 3.89407 11.595 3.85282C10.9234 3.15164 10.2518 2.46076 9.57014 1.76989Z" fill="white"/>
                                                <path d="M6.71088 8.14062C8.01403 8.14062 9.30715 8.14062 10.6103 8.14062C10.6704 8.14062 10.7406 8.14063 10.8008 8.15094C10.9511 8.18187 11.0614 8.30561 11.0514 8.44997C11.0413 8.60464 10.9511 8.70776 10.8008 8.72838C10.7406 8.73869 10.6805 8.73869 10.6304 8.73869C8.004 8.73869 5.38768 8.73869 2.76133 8.73869C2.47063 8.73869 2.34031 8.64589 2.34031 8.44997C2.33029 8.24374 2.48065 8.14062 2.77136 8.14062C4.08453 8.14062 5.3977 8.14062 6.71088 8.14062Z" fill="white"/>
                                                <path d="M6.69257 12.1133C8.00574 12.1133 9.31892 12.1133 10.6221 12.1133C10.9128 12.1133 11.0531 12.2164 11.0531 12.4226C11.0531 12.6185 10.9128 12.7113 10.6321 12.7113C8.00574 12.7113 5.38942 12.7113 2.76307 12.7113C2.47237 12.7113 2.33203 12.6082 2.33203 12.4123C2.33203 12.2164 2.47237 12.1236 2.75305 12.1236C4.07625 12.1133 5.38942 12.1133 6.69257 12.1133Z" fill="white"/>
                                                <path d="M8.45395 6.14953C9.1757 6.14953 9.90747 6.14953 10.6292 6.14953C10.6793 6.14953 10.7395 6.14953 10.7896 6.14953C10.96 6.17015 11.0603 6.29389 11.0603 6.44856C11.0603 6.60324 10.95 6.70635 10.7896 6.72697C10.7395 6.73729 10.6894 6.72697 10.6292 6.72697C9.1757 6.72697 7.73221 6.72697 6.2787 6.72697C5.988 6.72697 5.84766 6.62386 5.84766 6.41763C5.85768 6.22171 5.988 6.12891 6.26867 6.12891C7.00044 6.14953 7.72219 6.14953 8.45395 6.14953Z" fill="white"/>
                                                <path d="M4.93675 10.7192C4.21501 10.7192 3.49326 10.7192 2.78154 10.7192C2.7214 10.7192 2.65123 10.7192 2.59108 10.7088C2.44072 10.6882 2.3505 10.5851 2.34048 10.4304C2.33045 10.2861 2.44072 10.1623 2.59108 10.1314C2.65123 10.1211 2.71137 10.1211 2.76149 10.1211C4.21501 10.1211 5.6585 10.1211 7.11201 10.1211C7.14208 10.1211 7.17215 10.1211 7.20223 10.1211C7.41273 10.1314 7.54305 10.2448 7.54305 10.4304C7.53303 10.6057 7.41273 10.7192 7.20223 10.7192C6.45041 10.7192 5.69859 10.7192 4.93675 10.7192Z" fill="white"/>
                                                <path d="M4.43588 4.46916C3.8645 4.46916 3.29312 4.46916 2.71171 4.46916C2.61147 4.46916 2.51123 4.45885 2.43103 4.38667C2.27065 4.24231 2.33079 3.9639 2.5413 3.89172C2.61147 3.87109 2.68164 3.87109 2.75181 3.87109C3.8645 3.87109 4.97719 3.87109 6.08988 3.87109C6.11995 3.87109 6.15002 3.87109 6.1801 3.87109C6.3906 3.88141 6.52092 3.99483 6.52092 4.18044C6.52092 4.35573 6.3906 4.45885 6.1801 4.46916C5.58867 4.46916 5.00726 4.46916 4.43588 4.46916Z" fill="white"/>
                                                <path d="M3.72373 6.73479C3.3829 6.73479 3.03205 6.73479 2.69123 6.73479C2.46067 6.73479 2.33036 6.61105 2.34038 6.42544C2.35041 6.25015 2.4707 6.13672 2.70125 6.13672C3.39293 6.13672 4.09462 6.13672 4.78629 6.13672C5.0369 6.13672 5.17724 6.3017 5.11709 6.50793C5.077 6.67292 4.95671 6.73479 4.79632 6.73479C4.44547 6.73479 4.0846 6.73479 3.72373 6.73479Z" fill="white"/>
                                                <path d="M9.64676 10.7192C9.30593 10.7192 8.95509 10.7192 8.61426 10.7192C8.39373 10.7192 8.27344 10.6057 8.27344 10.4201C8.27344 10.2345 8.39373 10.1211 8.61426 10.1211C9.31596 10.1211 10.0177 10.1211 10.7193 10.1211C10.9299 10.1211 11.0602 10.2448 11.0602 10.4201C11.0501 10.5954 10.9299 10.7088 10.7193 10.7088C10.3585 10.7192 10.0076 10.7192 9.64676 10.7192Z" fill="white"/>
                                                <path d="M9.64676 14.6996C9.30593 14.6996 8.95509 14.6996 8.61426 14.6996C8.39373 14.6996 8.27344 14.5862 8.27344 14.4006C8.27344 14.215 8.39373 14.1016 8.61426 14.1016C9.31596 14.1016 10.0177 14.1016 10.7193 14.1016C10.9299 14.1016 11.0501 14.215 11.0602 14.3903C11.0702 14.5759 10.9399 14.6893 10.7193 14.6893C10.3585 14.6996 10.0076 14.6996 9.64676 14.6996Z" fill="white"/>
                                            </svg>
                                        </button>
                                        <button type="button" data-toggle="tooltip" title="Technique" style="--active-bg: green;" data-filter-type="Technique" class="ticketFilterbtn ticketFilterbtnStatus  btn-icon primary-btn--primary rounded border-0">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="17" viewBox="0 0 16 17" fill="none">
                                                <path d="M0.631225 5.73071C0.836097 5.74209 1.03528 5.75348 1.24015 5.75917C1.37104 5.76486 1.45071 5.70795 1.50762 5.58275C1.65558 5.26975 1.80355 4.95675 1.9572 4.64375C1.97427 4.60392 2.00273 4.56408 2.02549 4.52425C2.09947 4.39336 2.0824 4.27954 1.97427 4.18279C1.80924 4.03483 1.6442 3.88687 1.47917 3.7446C1.30844 3.59663 1.29706 3.47713 1.43364 3.30071C1.58729 3.10722 1.74095 2.91373 1.8946 2.72593C1.99704 2.59504 2.12793 2.57228 2.2702 2.66902C2.46369 2.79422 2.65718 2.92511 2.85636 3.05031C2.98156 3.12998 3.08399 3.12998 3.19781 3.03893C3.5165 2.78284 3.84088 2.53244 4.15957 2.27635C4.26769 2.19099 4.29615 2.08855 4.24493 1.95766C4.16526 1.73572 4.08559 1.51946 4.00022 1.29752C3.93762 1.13248 3.98884 1.01298 4.14819 0.933304C4.35306 0.836559 4.55793 0.734123 4.7628 0.637378C4.92784 0.557706 5.04734 0.591851 5.14409 0.745505C5.2636 0.938995 5.38311 1.12679 5.49692 1.32028C5.58229 1.46256 5.66765 1.50239 5.83269 1.46256C6.24243 1.36581 6.65217 1.27476 7.05622 1.17801C7.1985 1.14387 7.26109 1.0585 7.27248 0.916231C7.28955 0.682905 7.31231 0.45527 7.34077 0.221944C7.35215 0.0910541 7.46028 0 7.59117 0C7.85864 0 8.1318 0 8.39927 0C8.53016 0 8.6326 0.0967449 8.64967 0.233326C8.67812 0.472343 8.70089 0.71136 8.73503 0.944685C8.75211 1.09265 8.8204 1.16094 8.96836 1.19508C9.35534 1.28045 9.74801 1.3715 10.135 1.46256C10.2773 1.4967 10.374 1.45117 10.448 1.32597C10.5675 1.13248 10.687 0.938994 10.8065 0.739814C10.8862 0.614615 11.0114 0.569088 11.1423 0.631687C11.3813 0.739814 11.6146 0.853631 11.8536 0.97314C11.9845 1.03574 12.03 1.16663 11.9788 1.30321C11.9162 1.46825 11.8536 1.63328 11.791 1.79832C11.7455 1.91783 11.7683 2.01457 11.8593 2.09993C12.1723 2.40155 12.4796 2.69748 12.7926 2.99909C12.8951 3.09584 13.0089 3.10722 13.1284 3.02755C13.2991 2.91373 13.4755 2.79422 13.6463 2.6804C13.7942 2.58366 13.9137 2.59504 14.0275 2.72593C14.204 2.92511 14.3804 3.12429 14.5568 3.32347C14.6592 3.44298 14.6535 3.58525 14.534 3.69907C14.3633 3.85841 14.1926 4.01207 14.0275 4.16572C13.9308 4.25108 13.9137 4.35921 13.9706 4.47303C14.1527 4.84294 14.3349 5.21284 14.517 5.58275C14.5739 5.69088 14.6706 5.74209 14.7901 5.72502C15.0291 5.69088 15.2738 5.65673 15.5129 5.62259C15.6494 5.60551 15.7576 5.68518 15.7917 5.81607C15.86 6.08924 15.9226 6.3624 15.9909 6.63556C16.025 6.78352 15.9624 6.90303 15.8145 6.95425C15.5868 7.03392 15.3592 7.11359 15.1316 7.19327C15.0007 7.23879 14.9438 7.31847 14.9438 7.45505C14.9438 7.86479 14.9438 8.27453 14.9438 8.68428C14.9438 8.83224 15.0064 8.91191 15.143 8.95744C15.3592 9.03142 15.5755 9.1054 15.7917 9.17369C15.9283 9.21922 15.9966 9.32734 15.9681 9.46962C15.9226 9.7314 15.8657 9.99887 15.8145 10.2606C15.786 10.3972 15.6665 10.4712 15.5242 10.4541C15.2795 10.4257 15.0405 10.3972 14.7958 10.3688C14.682 10.3574 14.5796 10.4086 14.5283 10.511C14.3462 10.881 14.1698 11.2566 13.9877 11.6265C13.9365 11.7346 13.9536 11.837 14.0446 11.9224C14.1983 12.0647 14.3519 12.2069 14.5113 12.3492C14.6479 12.4744 14.6592 12.5996 14.5511 12.7476C14.3918 12.9524 14.2324 13.163 14.0731 13.3736C13.9706 13.5101 13.8397 13.5329 13.6918 13.4418C13.5154 13.328 13.3446 13.2199 13.1682 13.1061C13.0316 13.015 12.9292 13.0207 12.804 13.1232C12.5024 13.3736 12.2008 13.6183 11.8992 13.8687C11.7683 13.9768 11.7455 14.0565 11.8024 14.2215C11.8707 14.4378 11.9447 14.6483 12.013 14.8646C12.0642 15.0182 12.0187 15.132 11.8764 15.2003C11.6488 15.3141 11.4211 15.428 11.1878 15.5361C11.0455 15.6044 10.9203 15.5702 10.835 15.4337C10.7098 15.2288 10.5846 15.0239 10.4594 14.8247C10.3854 14.7109 10.2943 14.6711 10.1634 14.6995C9.89597 14.7564 9.6285 14.819 9.35534 14.876C9.22445 14.9044 9.09356 14.9329 8.96836 14.9613C8.83178 14.9898 8.76349 15.0637 8.74641 15.2003C8.71796 15.445 8.68951 15.6841 8.66105 15.9288C8.64398 16.071 8.55292 16.1678 8.41065 16.1735C8.16594 16.1792 7.91555 16.1792 7.67084 16.1735C7.55133 16.1735 7.45459 16.0767 7.43751 15.9515C7.40906 15.758 7.37491 15.5645 7.34646 15.3711C7.32939 15.2459 7.24971 15.1719 7.1302 15.1491C6.68063 15.0581 6.23105 14.9613 5.77578 14.8703C5.65627 14.8475 5.55952 14.893 5.49692 15.0011C5.41156 15.1491 5.3262 15.2971 5.24083 15.4507C5.16116 15.5873 5.03596 15.6271 4.89369 15.5645C4.62053 15.445 4.34737 15.3255 4.0742 15.206C3.92624 15.1434 3.86933 15.0011 3.93762 14.8532C4.0173 14.6768 4.10266 14.4947 4.18802 14.3182C4.25062 14.1817 4.23924 14.0849 4.13111 13.9825C3.8295 13.6922 3.52219 13.4077 3.22057 13.1175C3.11814 13.0207 3.01001 13.0093 2.88481 13.089C2.67994 13.2199 2.47507 13.3508 2.27589 13.4817C2.13362 13.5727 2.00842 13.55 1.90029 13.4191C1.75233 13.2313 1.60437 13.0492 1.4564 12.8614C1.35397 12.7305 1.35966 12.611 1.46778 12.4915C1.62713 12.3151 1.78647 12.1443 1.95151 11.9679C2.06533 11.8427 2.07671 11.7573 2.00842 11.6037C1.84338 11.2622 1.67835 10.9208 1.50762 10.5793C1.44502 10.4484 1.35966 10.3972 1.206 10.4086C0.955605 10.4257 0.710898 10.4484 0.460499 10.4598C0.318227 10.4712 0.221482 10.3915 0.187337 10.255C0.124737 10.0046 0.0678286 9.75416 0.0109199 9.50376C-0.0232254 9.36149 0.0223016 9.25905 0.153192 9.18507C0.358063 9.07695 0.562935 8.96313 0.767806 8.86069C0.870242 8.80948 0.927151 8.73549 0.932842 8.61599C0.949914 8.32575 0.972678 8.04121 0.995441 7.75097C1.00113 7.65992 1.00682 7.56317 1.01251 7.47212C1.0239 7.32416 0.966987 7.2331 0.830406 7.17619C0.619844 7.09083 0.409281 7.01116 0.193028 6.9258C0.0336834 6.8632 -0.0232253 6.76076 0.0166108 6.59003C0.0678287 6.36809 0.113356 6.14615 0.170264 5.9242C0.20441 5.78193 0.301155 5.70795 0.449117 5.70795C0.506026 5.72502 0.568626 5.73071 0.631225 5.73071ZM13.8739 7.97292C13.817 4.76895 11.1764 2.19668 7.97815 2.20806C4.75142 2.21944 2.04256 4.89415 2.12223 8.21762C2.19622 11.3931 4.83109 14.0052 8.08058 13.9654C11.2675 13.9256 13.9137 11.2907 13.8739 7.97292Z" fill="white"/>
                                                <path d="M10.1449 4.7835C10.0709 4.94853 9.95711 5.06804 9.8376 5.18755C9.72947 5.28999 9.62135 5.38673 9.5246 5.50055C9.34249 5.7168 9.3368 5.88184 9.50184 6.11516C9.60996 6.26313 9.73516 6.38833 9.89451 6.48507C10.0425 6.57612 10.1961 6.57043 10.3384 6.47369C10.3953 6.43385 10.4522 6.38833 10.5034 6.3428C10.6685 6.18914 10.8278 6.0298 10.9872 5.88184C11.0213 5.85338 11.0668 5.83631 11.118 5.81355C11.192 6.09809 11.1636 6.35418 11.0441 6.59889C10.8676 6.95741 10.5888 7.18505 10.1961 7.27041C10.0425 7.30456 9.88882 7.29317 9.74085 7.25903C9.68964 7.24765 9.63273 7.23627 9.58151 7.23057C9.41078 7.2135 9.2742 7.26472 9.15469 7.38992C8.59699 7.95901 8.03359 8.52809 7.47019 9.09149C7.27101 9.29067 7.06614 9.48985 6.86127 9.68334C6.77022 9.76871 6.74745 9.87114 6.77022 9.99065C6.82144 10.241 6.82143 10.4914 6.719 10.7305C6.54258 11.1345 6.22958 11.3678 5.79708 11.4191C5.21092 11.493 4.68736 11.1231 4.54508 10.5427C4.36867 9.837 4.91499 9.13702 5.63773 9.13702C5.73448 9.13702 5.82553 9.1484 5.92228 9.16547C6.07024 9.19962 6.18406 9.15409 6.29218 9.05165C6.719 8.61915 7.15151 8.18664 7.57832 7.75983C7.90839 7.42976 8.23846 7.09399 8.57422 6.76961C8.7165 6.63303 8.75633 6.49076 8.71081 6.30296C8.60837 5.9046 8.66528 5.529 8.93844 5.21031C9.14331 4.96561 9.41647 4.83472 9.72947 4.80057C9.86036 4.77212 9.99694 4.7835 10.1449 4.7835ZM5.67757 9.69472C5.58082 9.69472 5.48408 9.69472 5.38733 9.69472C5.36457 9.69472 5.33612 9.7118 5.32473 9.72887C5.22799 9.8939 5.13124 10.0532 5.04019 10.224C5.02881 10.2467 5.02881 10.2809 5.04019 10.3036C5.13124 10.4687 5.22799 10.6337 5.32473 10.7988C5.33612 10.8158 5.37026 10.8386 5.39303 10.8386C5.58082 10.8443 5.77431 10.8443 5.96211 10.8386C5.98488 10.8386 6.01902 10.8215 6.0304 10.7988C6.12715 10.6394 6.2182 10.4744 6.30926 10.3093C6.32064 10.2866 6.32064 10.2467 6.30926 10.224C6.2182 10.0589 6.12715 9.89959 6.0304 9.73456C6.01902 9.7118 5.98488 9.69472 5.95642 9.69472C5.85968 9.69472 5.76862 9.69472 5.67757 9.69472Z" fill="white"/>
                                                <path d="M8.08203 8.86602C8.36658 8.58717 8.63974 8.31401 8.91859 8.03516C8.94135 8.06361 8.9755 8.09207 8.99826 8.12621C9.17468 8.42783 9.43646 8.63839 9.721 8.83188C10.0738 9.0709 10.4267 9.30991 10.7397 9.60015C11.0071 9.85055 11.2405 10.1237 11.3998 10.4538C11.6047 10.8692 11.36 11.3529 10.899 11.4212C10.7852 11.4383 10.6714 11.4098 10.5689 11.3643C10.2958 11.2391 10.0681 11.057 9.8462 10.8521C9.55028 10.579 9.30557 10.2603 9.07793 9.92453C8.94135 9.73104 8.80477 9.53755 8.65681 9.35544C8.52592 9.1904 8.37227 9.04813 8.18447 8.94001C8.15032 8.91724 8.12187 8.88879 8.08203 8.86602Z" fill="white"/>
                                                <path d="M5.10938 5.20087C5.16628 5.14965 5.2175 5.10412 5.26303 5.05859C5.68984 5.36021 6.05975 5.71874 6.41828 6.09433C6.74835 6.43579 7.08411 6.77155 7.41418 7.113C7.47678 7.18129 7.55076 7.2382 7.61336 7.3008C7.53369 7.38616 7.4654 7.46583 7.39142 7.54551C7.26053 7.41462 7.13533 7.29511 7.01013 7.1756C6.54917 6.73171 6.08251 6.28782 5.62724 5.83824C5.47928 5.69028 5.35977 5.51386 5.22319 5.34883C5.18905 5.3033 5.1549 5.25777 5.10938 5.20087Z" fill="white"/>
                                            </svg>
                                        </button>
                                        <button type="button" data-toggle="tooltip" title="Financier" style="--active-bg: green;" data-filter-type="Financier" class="ticketFilterbtn ticketFilterbtnStatus  btn-icon primary-btn--primary rounded border-0">
                                            <svg xmlns="http://www.w3.org/2000/svg" width="14" height="17" viewBox="0 0 14 17" fill="none">
                                                <path d="M3.92983 0.00041503C4.87155 0.00816884 5.79784 0.124476 6.68553 0.465644C7.00973 0.589704 7.3185 0.752534 7.56551 1.00841C7.85111 1.31856 7.85883 1.62096 7.58094 1.93887C7.35709 2.2025 7.05605 2.36533 6.74729 2.47388C4.83296 3.14846 2.92635 3.14846 1.01974 2.44286C0.788164 2.35757 0.579749 2.22576 0.394492 2.06293C-0.0454953 1.66748 -0.0454953 1.27204 0.40993 0.892103C0.765007 0.597458 1.18184 0.434628 1.6141 0.310567C2.37057 0.0934607 3.14248 -0.00733878 3.92983 0.00041503ZM1.99234 1.08595C2.58671 0.94638 3.21195 0.861088 3.8372 0.84558C3.91439 0.84558 3.9993 0.814565 3.99158 0.713765C3.98386 0.612966 3.89895 0.589704 3.82176 0.597458C3.18108 0.62072 2.54039 0.659489 1.92287 0.84558C1.84568 0.868842 1.72989 0.899857 1.76849 1.02392C1.79936 1.10921 1.89971 1.08595 1.99234 1.08595Z" fill="white"/>
                                                <path d="M1.10077 12.7109C1.08533 12.5559 1.12393 12.4551 1.29374 12.4318C1.37094 12.4163 1.46356 12.4085 1.45585 12.3077C1.44813 12.2069 1.34778 12.2069 1.27831 12.1914C1.10849 12.1604 1.09305 12.0364 1.10849 11.8968C1.17796 11.1524 1.47128 10.5011 1.93443 9.92732C2.02706 9.81101 2.1274 9.76449 2.25863 9.88079C2.31266 9.92732 2.38213 9.98935 2.45932 9.91956C2.5288 9.85753 2.50564 9.77224 2.44389 9.71021C2.2895 9.54738 2.38213 9.44658 2.52108 9.33803C3.06913 8.89606 3.69438 8.64794 4.38137 8.55489C4.55119 8.53163 4.69785 8.54714 4.71329 8.76425C4.72101 8.83403 4.75189 8.89606 4.82908 8.90381C4.92943 8.91932 4.9603 8.84178 4.97574 8.76425C5.01434 8.51612 5.18416 8.53939 5.35397 8.56265C6.02553 8.66345 6.63534 8.91932 7.17568 9.34578C7.31462 9.45433 7.39953 9.56289 7.24515 9.72572C7.19111 9.78775 7.16024 9.86529 7.22971 9.93507C7.29918 10.0049 7.37637 9.96609 7.43812 9.91181C7.60794 9.75673 7.70829 9.85753 7.81636 9.98935C8.24091 10.5399 8.51107 11.1602 8.59598 11.858C8.61914 12.0286 8.6037 12.1682 8.39529 12.2069C8.32582 12.2224 8.23319 12.238 8.24091 12.3388C8.24863 12.4163 8.32582 12.4318 8.38757 12.4396C8.58827 12.4706 8.61914 12.5946 8.59598 12.773C8.50336 13.4863 8.24091 14.1144 7.7932 14.6726C7.69285 14.8045 7.59251 14.8742 7.44584 14.7269C7.39181 14.6726 7.31462 14.6261 7.24515 14.7037C7.17568 14.7734 7.22199 14.851 7.2683 14.913C7.42269 15.0836 7.31462 15.1844 7.18339 15.293C6.63534 15.7349 6.0101 15.9753 5.3231 16.0838C5.13012 16.1149 4.99118 16.0761 4.97574 15.8435C4.96802 15.7737 4.93715 15.7117 4.86767 15.7039C4.77505 15.6962 4.72873 15.7659 4.72101 15.8512C4.69785 16.1226 4.52803 16.1149 4.33506 16.0838C3.70209 15.9753 3.12316 15.7504 2.60599 15.3627C2.44389 15.2464 2.27407 15.1301 2.46704 14.8975C2.50564 14.8432 2.51336 14.7734 2.45161 14.7192C2.38985 14.6649 2.3281 14.6882 2.27407 14.7347C2.14284 14.8587 2.03478 14.8432 1.91899 14.7037C1.44813 14.1066 1.1934 13.4398 1.10077 12.7109ZM4.85996 15.2154C6.4964 15.2077 7.76232 13.9205 7.75461 12.2767C7.74689 10.6717 6.41921 9.33803 4.85224 9.36129C3.22351 9.38455 1.92671 10.6872 1.92671 12.3C1.92671 13.9205 3.23895 15.2232 4.85996 15.2154Z" fill="white"/>
                                                <path d="M9.67565 10.6684C9.5753 10.6684 9.46723 10.6606 9.36689 10.6684C8.81883 10.7227 8.43288 10.5521 8.14727 10.0248C7.83079 9.43553 7.29818 9.03233 6.70381 8.72218C6.59574 8.66791 6.41048 8.63689 6.4182 8.49732C6.42592 8.33449 6.61118 8.31123 6.73468 8.2492C7.35221 7.97006 8.00833 7.83049 8.67217 7.76846C9.8995 7.65216 11.1114 7.70643 12.2847 8.11739C12.6243 8.23369 12.9563 8.38102 13.2264 8.62914C13.6433 9.00907 13.6355 9.42003 13.1955 9.7767C12.7787 10.1179 12.277 10.2962 11.7675 10.4203C11.0882 10.5908 10.3858 10.6839 9.67565 10.6684Z" fill="white"/>
                                                <path d="M3.80065 4.55339C3.09049 4.58441 2.29543 4.4681 1.5158 4.23549C1.14529 4.12693 0.79021 3.97186 0.473728 3.73924C0.0954939 3.45235 -0.0974828 2.80878 0.0491795 2.37457C0.103213 2.2195 0.172685 2.25051 0.280752 2.31254C2.25683 3.49112 4.3487 3.36706 6.47144 2.85531C6.84968 2.76226 7.19704 2.58392 7.51352 2.35906C7.69106 2.235 7.76825 2.22725 7.79141 2.48313C7.85316 3.32054 7.65246 3.68497 6.88056 4.02613C5.93883 4.45259 4.93535 4.5689 3.80065 4.55339Z" fill="white"/>
                                                <path d="M3.56304 6.17174C2.8606 6.15623 1.81081 6.04768 0.845923 5.55919C0.143487 5.20251 -0.0340512 4.8691 0.0508586 4.09372C0.0662967 3.93864 0.0817348 3.79132 0.297869 3.93089C1.74905 4.85359 3.35462 4.89236 4.99106 4.76055C5.89419 4.68301 6.76645 4.48141 7.53836 3.96191C7.70818 3.8456 7.77765 3.86886 7.8008 4.08597C7.88571 4.89236 7.70046 5.24128 6.96714 5.59796C6.21068 5.97014 5.13773 6.17174 3.56304 6.17174Z" fill="white"/>
                                                <path d="M3.69131 7.78564C2.98887 7.77014 2.08574 7.66934 1.22121 7.34368C0.958759 7.24288 0.69631 7.12657 0.472457 6.94823C0.0787847 6.63808 -0.0910348 6.10307 0.0479084 5.63008C0.0942228 5.4595 0.179133 5.48276 0.302638 5.55255C2.30188 6.6846 4.40146 6.62257 6.53193 6.04879C6.87928 5.95574 7.20349 5.79291 7.49681 5.58356C7.71294 5.42849 7.7747 5.50602 7.79013 5.73864C7.84417 6.56829 7.69751 6.83192 6.94876 7.20411C6.19229 7.57629 5.09618 7.78564 3.69131 7.78564Z" fill="white"/>
                                                <path d="M9.52031 15.4842C9.08033 15.4997 8.50911 15.4455 7.9379 15.3292C7.72177 15.2826 7.66002 15.2051 7.82212 15.0268C7.84527 14.9958 7.88387 14.9725 7.89931 14.9415C8.23123 14.1661 8.83332 14.0265 9.5975 14.1273C10.1919 14.2049 10.8017 14.1196 11.396 14.0033C12.0676 13.8715 12.7237 13.6931 13.2872 13.2744C13.4493 13.1503 13.5265 13.1736 13.5574 13.3907C13.6655 14.1273 13.4725 14.5383 12.8009 14.8794C11.8206 15.3679 10.7476 15.4842 9.52031 15.4842Z" fill="white"/>
                                                <path d="M9.59124 12.5625C10.8572 12.4772 12.1694 12.4307 13.3118 11.6475C13.5048 11.5157 13.5511 11.5933 13.5666 11.7871C13.6515 12.5702 13.4585 12.9424 12.7561 13.2836C11.521 13.8729 10.2165 13.9582 8.87336 13.8496C8.68039 13.8341 8.63407 13.7488 8.67267 13.5705C8.73442 13.3224 8.79617 13.0665 8.83477 12.8184C8.86564 12.5935 8.97371 12.5005 9.19756 12.5392C9.31335 12.547 9.42914 12.547 9.59124 12.5625Z" fill="white"/>
                                                <path d="M9.65101 10.9172C10.9247 10.8784 12.1906 10.7854 13.3021 10.0488C13.4565 9.94796 13.526 9.97898 13.5569 10.1651C13.6726 10.7931 13.4951 11.2739 12.9316 11.5763C11.7429 12.2276 10.4384 12.3206 9.1184 12.2663C9.01033 12.2586 8.90226 12.2276 8.87911 12.1113C8.80963 11.7624 8.74016 11.4057 8.69385 11.049C8.67069 10.8939 8.81735 10.9249 8.9177 10.9249C9.16471 10.9172 9.41172 10.9172 9.65101 10.9172Z" fill="white"/>
                                                <path d="M4.97465 8.25132C3.97889 8.27458 3.19154 8.51495 2.49683 9.0267C2.28069 9.18953 2.08 9.22054 1.81755 9.15076C1.48563 9.05771 1.15371 8.94916 0.844947 8.78633C0.15023 8.42966 -0.0427463 8.06523 0.0421635 7.28985C0.0653207 7.08825 0.111635 7.04948 0.304612 7.15803C2.45051 8.35987 4.6736 8.26683 6.92757 7.51471C7.10511 7.45268 7.25949 7.32862 7.43703 7.24332C7.5451 7.1968 7.66088 6.96419 7.76123 7.15803C7.83842 7.31311 7.87702 7.57674 7.60685 7.67754C7.47563 7.73181 7.33668 7.75508 7.19774 7.79384C7.12055 7.81711 7.04336 7.83261 6.98161 7.87138C6.31005 8.23581 5.63077 8.54596 4.97465 8.25132Z" fill="white"/>
                                                <path d="M0.0427291 9.22791C0.0427291 9.12711 0.0427291 9.05733 0.0427291 8.9953C0.0504482 8.8945 0.0118528 8.77044 0.104482 8.70841C0.212549 8.63087 0.289739 8.75493 0.36693 8.80921C0.729726 9.06508 1.13112 9.23567 1.55567 9.33647C1.91074 9.42176 1.91074 9.56133 1.67917 9.78619C1.62514 9.84046 1.58654 9.91025 1.54023 9.97228C1.11568 10.5693 0.899546 10.5848 0.343773 10.0653C0.104482 9.82496 0.0195719 9.53031 0.0427291 9.22791Z" fill="white"/>
                                                <path d="M0.0503057 10.7705C0.0503057 10.6697 0.0425866 10.5612 0.0503057 10.4604C0.0657438 10.2975 0.135215 10.282 0.281878 10.3518C1.08466 10.755 1.11554 10.8325 0.84537 11.7242C0.791336 11.9026 0.721865 11.9181 0.575202 11.8405C0.212406 11.6467 0.0425866 11.3288 0.0503057 10.7705Z" fill="white"/>
                                                <path d="M7.48282 12.3274C7.4751 13.7851 6.25549 15.0024 4.81202 14.9792C3.36084 14.9559 2.17982 13.7386 2.18754 12.2809C2.19526 10.8309 3.43031 9.61355 4.86605 9.62905C6.32496 9.64456 7.49054 10.8542 7.48282 12.3274ZM5.51446 10.7378C4.86605 10.7378 4.3566 10.9627 4.04011 11.521C3.91661 11.7381 3.80082 11.9164 3.52294 11.8932C3.45346 11.8854 3.35312 11.9087 3.36084 12.0095C3.36856 12.087 3.44575 12.0948 3.5075 12.1103C3.631 12.1413 3.7931 12.118 3.7931 12.3041C3.7931 12.4747 3.64644 12.4437 3.53837 12.4669C3.44575 12.4825 3.33768 12.498 3.35312 12.6143C3.36856 12.7306 3.48434 12.7306 3.56925 12.7228C3.80082 12.7073 3.90889 12.8314 4.00924 13.0252C4.31028 13.6068 4.81974 13.8704 5.46042 13.8704C5.63796 13.8704 5.96216 14.0022 5.9776 13.7386C5.98532 13.5215 5.66112 13.6223 5.4913 13.6145C5.02044 13.6068 4.6422 13.4517 4.3566 13.0717C4.20993 12.8701 4.22537 12.7383 4.51098 12.7306C4.78115 12.7306 5.05131 12.7383 5.32148 12.7228C5.43727 12.7151 5.63024 12.7771 5.62252 12.591C5.6148 12.4282 5.42955 12.4592 5.30604 12.4592C5.01272 12.4514 4.71167 12.4592 4.41835 12.4514C4.30256 12.4514 4.12502 12.4825 4.13274 12.2886C4.14046 12.1025 4.30256 12.1258 4.42607 12.118C4.75799 12.1103 5.08991 12.1103 5.42955 12.1103C5.50674 12.1103 5.60709 12.1103 5.6148 12.0172C5.63024 11.8854 5.50674 11.8932 5.42183 11.8932C5.1285 11.8854 4.82746 11.8854 4.53413 11.8854C4.43379 11.8854 4.30256 11.9009 4.26397 11.7846C4.22537 11.6761 4.31028 11.5908 4.37975 11.5132C4.66536 11.1643 5.03587 11.0015 5.4913 11.0015C5.66112 11.0015 5.9776 11.11 5.9776 10.8774C5.96988 10.6293 5.6534 10.7921 5.51446 10.7378Z" fill="white"/>
                                            </svg>
                                        </button>
                                        <button type="button" data-toggle="tooltip" title="Reset" id="resetButton" data-filter-type="" class="ticketFilterbtn btn-icon btn-danger rounded border-0 d-none">
                                            <i class="bi bi-arrow-repeat"></i>
                                        </button>
                                    </div>
                                    <div class="row">
                                        <div class="col-12 pt-3">
                                            <div class="ticket-card-list-wrapper-inner">
                                                <ul class="ticket-card-list">
                                                    @foreach ($tickets as $ticket)
                                                        @php
                                                            $created_at = \Carbon\Carbon::parse($ticket->created_at)->format('y-m-d');
                                                        @endphp
                                                        <li class="ticket-card-list__item">
                                                            <div class="ticket-card-list__item__time">
                                                                <small class="text-success">{{ \Carbon\Carbon::parse($ticket->created_at)->format('d/m/Y') }}</small>
                                                                @if($ticket->close_at)
                                                                    <small class="text-danger">- {{ \Carbon\Carbon::parse($ticket->close_at)->format('d/m/Y') }}</small>
                                                                @endif
                                                            </div>
                                                            <button data-filter-text="{{ $ticket->close_at ? 'closed':'open' }} {{ $ticket->ticket_type }}" class="ticket-card {{ $loop->index == 0 ? 'active':'' }}" data-id="{{ $ticket->id }}" type="button" role="article">
                                                                <span class="ticket-card__rings"></span>
                                                                <div class="ticket-card__header">
                                                                    <div class="ticket-card__header__details">
                                                                        <div class="ticket-card__header__details__icon">
                                                                            <i class="bi bi-ticket-perforated"></i>
                                                                        </div>
                                                                        <strong class="ticket-card__header__details__text">{{ __('Ticket') }} :</strong>
                                                                        <span class="ticket-card__header__details__id">{{ $ticket->ticket_number }}</span>
                                                                    </div>
                                                                    <span type="button" class="ticket-card__header__time border bg-white rounded" style="color: {{ $ticket->ticket_type == 'Administratif'? "#FF33FF": ($ticket->ticket_type == 'Technique'? "#B45F06":($ticket->ticket_type == 'Financier'? "#38761D":''))  }}">{{ $ticket->ticket_type }}</span>
                                                                </div>
                                                                <div class="ticket-card__body">
                                                                    {{-- @if($ticket->close_at)
                                                                        <p class="ticket-card__text">Ouvert : {{ \Carbon\Carbon::parse($ticket->created_at)->format('d/m/Y') }} ({{ $ticket->deadline }} jours)</p>
                                                                        <p class="ticket-card__text">Fermé : {{ \Carbon\Carbon::parse($ticket->close_at)->format('d/m/Y') }}
                                                                            @if (\Carbon\Carbon::parse($created_at)->diffInDays($ticket->close_at) > $ticket->deadline)
                                                                                <span class="text-danger">(+ {{ \Carbon\Carbon::parse($created_at)->diffInDays($ticket->close_at) - $ticket->deadline }} jours)</span>
                                                                            @endif
                                                                        </p>
                                                                    @else
                                                                        <p class="ticket-card__text">Ouvert : {{ \Carbon\Carbon::parse($ticket->created_at)->format('d/m/Y') }} ({{ $ticket->deadline }} jours)</p>
                                                                        <p class="ticket-card__text">Echéance : {{ \Carbon\Carbon::parse($ticket->created_at)->addDays($ticket->deadline)->format('d/m/Y') }}
                                                                            @if (\Carbon\Carbon::parse($created_at)->diffInDays(\Carbon\Carbon::today()) > $ticket->deadline)
                                                                                <span class="text-danger">
                                                                                     (+ {{ \Carbon\Carbon::parse($created_at)->diffInDays(\Carbon\Carbon::today()) - $ticket->deadline }} jours)
                                                                                </span>
                                                                            @else
                                                                                <span>
                                                                                    ({{ $ticket->deadline - \Carbon\Carbon::parse($created_at)->diffInDays(\Carbon\Carbon::today()) }} jours)
                                                                                </span>

                                                                            @endif
                                                                        </p>
                                                                    @endif --}}
                                                                    <h3 class="ticket-card__title">{{ $ticket->project->Prenom.' '.$ticket->project->Nom }}</h3>
                                                                    <p class="ticket-card__text"> {{ $ticket->problem->name ?? '' }}</p>
                                                                </div>
                                                                <div class="ticket-card__footer">
                                                                    <a href="#!" class="ticket-card__footer__user">
                                                                        <div class="ticket-card__footer__user__avatar">
                                                                            @if ($ticket->openby->profile_photo)
                                                                                <img  loading="lazy"  src="{{ asset('uploads/crm/profiles') }}/{{ $ticket->openby->profile_photo }}"  class="ticket-card__footer__user__avatar__image">
                                                                            @else
                                                                                <img  loading="lazy"  src="{{ asset('crm_assets/assets/images/icons/user.png') }}"  class="ticket-card__footer__user__avatar__image">
                                                                            @endif
                                                                        </div>
                                                                        <span class="ticket-card__footer__user__avatar__name">{{ $ticket->openby->name ?? '' }}</span>
                                                                    </a>
                                                                    {{-- <ul class="ticket-card__footer__list nav">
                                                                        <li class="ticket-card__footer__list__item">
                                                                            <i class="bi bi-paperclip"></i>
                                                                            <span class="ticket-card__footer__list__item__text">2</span>
                                                                        </li>
                                                                        <li class="ticket-card__footer__list__item">
                                                                            <i class="bi bi-chat"></i>
                                                                            <span class="ticket-card__footer__list__item__text">4</span>
                                                                        </li>
                                                                    </ul> --}}
                                                                </div>
                                                            </button>
                                                        </li>
                                                    @endforeach
                                                </ul>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="ticket-main-wrapper col-md" id="ticketMessageBody">
                        @if ($single_ticket)
                            @include('admin.ticket_message_body')
                        @else
                            <h2>
                                Aucun ticket trouvé
                            </h2>
                        @endif
                    </div>
                </div>
            </div>
        </div>
    </section>

    <!-- Ticket Create Modal -->
    <div class="modal modal--aside fade" id="createTicketModal" tabindex="-1" aria-labelledby="createTicketModalTitle" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-lg">
            <div class="modal-content border-0">
                <div class="modal-header border-0 pb-0">
                    <button type="button" class="close d-inline-flex align-items-center justify-content-center rounded-circle m-0 p-0 ml-auto" data-dismiss="modal" aria-label="Close">
                        <span class="novecologie-icon-close" aria-hidden="true"></span>
                    </button>
                </div>
                <div class="modal-body pt-0">
                    <form action="{{ route('ticket.store') }}" method="POST" class="form mx-auto">
                        @csrf
                        <h5 class="form__title position-relative text-center mb-4" id="createTicketModalTitle">{{ __('Create New Ticket') }}</h5>
                        <div class="form-group">
                            <label for="ticketClient" class="form-label">Client <span class="text-danger">*</span></label>
                            <select name="project_id" id="ticketClient" class="select2_select_option shadow-none form-control required_field" data-error-message="Le champ client est requis">
                                <option value="" selected>{{ __('Select') }}</option>
                                @foreach ($projects as $project)
                                    <option {{ request()->client == $project['id'] ? 'selected':'' }} value="{{ $project['id'] }}">{{ $project['Prenom'].' '.$project['Nom'].'-'.$project['tag'].'-'.$project['Code_Postal'] }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div id="ticketClientWrap">
                            <div class="form-group">
                                <label class="form-label">Département</label>
                                <input type="text" disabled class="form-control shadow-none px-3">
                            </div>
                            <div class="form-group">
                                <label class="form-label">Travaux</label>
                                <select disabled class="select2_select_option shadow-none form-control">

                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">TAG</label>
                                <select disabled class="select2_select_option shadow-none form-control">

                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Gestionnaire projet</label>
                                <select disabled class="select2_select_option shadow-none form-control">

                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Telecommercial projet</label>
                                <select disabled class="select2_select_option shadow-none form-control">

                                </select>
                            </div>
                            <div class="form-group">
                                <label class="form-label">Responsable Commercial</label>
                                <select disabled class="select2_select_option shadow-none form-control">

                                </select>
                            </div>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="ticketAssign">Personnes assignés <span class="text-danger">*</span></label>
                            <select class="select2_select_option shadow-none form-control required_field" data-error-message="Le champ personnes assignésest est requis"  id="ticketAssign" name="user_id[]" multiple>
                                @foreach ($users as $user)
                                    <option value="{{ $user->id }}">{{ $user->name }}</option>
                                @endforeach
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="client_status">Statut installation <span class="text-danger">*</span></label>
                            <select class="select2_select_option shadow-none form-control required_field" data-error-message="Le champ statut installation est requis" name="client_status">
                                <option value="" selected>{{ __('Select') }}</option>
                                <option value="Client installé">Client installé</option>
                                <option value="Client non installé">Client non installé</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="ticketType"> Type de ticket <span class="text-danger">*</span></label>
                            <select class="select2_select_option shadow-none form-control required_field" data-error-message="Le champ type de ticket est requis"id="ticketType" name="ticket_type">
                                <option value="" selected>{{ __('Select') }}</option>
                                <option value="Administratif">Administratif</option>
                                <option value="Technique">Technique</option>
                                <option value="Financier">Financier</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="ticketStatus">Type de problème <span class="text-danger">*</span></label>
                            <select class="select2_select_option shadow-none form-control required_field" data-error-message="Le champ type de problème est requis" id="ticketStatus" name="problem_id">
                                <option value="" selected>{{ __('Select') }}</option>

                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label" for="ticketDeadline">Échéance resolution ticket</label>
                            <input type="text" readonly name="deadline" id="ticketDeadline" class="form-control shadow-none px-3">
                            <div class="invalid-feedback">{{ __('This field in necessary') }}</div>
                        </div>
                        <div class="form-group">
                            <label for="ticketDescription" class="form-label">Précisions</label>
                            <textarea name="details" id="ticketDescription" class="form-control shadow-none px-3"></textarea>
                        </div>
                        <div class="form-group d-flex flex-column align-items-center mt-4">
                            <button type="submit" class="primary-btn primary-btn--primary primary-btn--lg rounded border-0 mb-3 ticketCreateButton">{{ __('Create') }}</button>
                        </div>
                    </form>
                </div>
            </div>
        </div>
    </div>
@endsection
@push('plugins-script')
    <script src="{{ asset('crm_assets/assets/plugins/tagify/js/tagify.min.js') }}"></script>
    <script src="{{ asset('crm_assets/assets/plugins/fancybox/jquery.fancybox.min.js') }}"></script>
@endpush
@push('js')
    <script>
        function chatCardHeightMeasure(){
            $(".ticket-main__chat-card__body").attr({
                style: `
                    --chat-header: ${$('.ticket-main__chat-card__header').outerHeight()}px;
                    --chat-footer: ${$('.ticket-main__chat-card__footer').outerHeight()}px;
                `
            });
            $(".ticket-main").attr({
                style: `
                    --chat-main: ${$('.ticket-main').outerHeight()}px;
                `
            });
            // $(".ticket-main__aside").attr({
            //     style: `
            //         --ticket-aside-header: ${$('.ticket-main__aside__header').outerHeight()}px;
            //     `
            // });
        };
        $('[data-fancybox="gallery"]').fancybox({
            buttons : [
                'download',
                'close'
            ]
        });
        var tag_user_list = [
            @foreach ($users as $user)
                { id:"{{ $user->id }}", value:'{{ $user->name }}', title:'{{ $user->name }}'},
            @endforeach
        ]

        function tagifyInput(){
            // initialize Tagify
            var input = document.querySelector('.tagifyInput'),

                // init Tagify script on the above inputs
                tagify = new Tagify(input, {
                //  mixTagsInterpolator: ["{{", "}}"],
                    mode: 'mix',  // <--  Enable mixed-content
                    pattern: /@/,  // <--  Text starting with @ or # (if single, String can be used here)

                    whitelist: tag_user_list.map(function(item){ return typeof item == 'string' ? {value:item} : item}),
                    enforceWhitelist: true,

                    dropdown : {
                        enabled: 1,
                        position: "text",
                        highlightFirst: true  // automatically highlights first sugegstion item in the dropdown
                    }
                })


            tagify.on('input', function(e){
                var prefix = e.detail.prefix;

                if( prefix ){
                    if( prefix == '@' )
                        tagify.whitelist = tag_user_list;

                    if( e.detail.value.length > 1 )
                        tagify.dropdown.show.call(tagify, e.detail.value);
                }
            })
        }

        tagifyInput();
        $(window).on('load', function () {
            console.log($('.ticket-main').length);
            /* List Animation function */
            $(".ticket-card-list-wrapper").attr({
                style: `
                    --ticket-main-height: ${ $('.ticket-main').is(':visible') ? $('.ticket-main').outerHeight() : ($('body').outerHeight() - 280)}px;
                `
            });

            chatCardHeightMeasure();
        });

        $(window).on("resize", function(){
            chatCardHeightMeasure();
        });

        $(document).ready(function () {
            $("body").on('change', '#commentInputFile', function(){
                let value = $(this).val().replace(/C:\\fakepath\\/i, '');
                $('#commentInputFileName').text(value);
            });

            $('body').on('click', '.ticketCreateButton', function(e){
                e.preventDefault();
                let form = $(this).closest('form');
                let required_input = form.find('.required_field');
                let error_status = false;
                required_input.each(function(){
                    if(jQuery.type($(this).val()) == 'array'){
                    }else{
                        if($(this).val() == null || !$(this).val().trim()){
                            $('#errorMessage').html($(this).data('error-message'));
                            $('.toast.toast--error').toast('show');
                            $(this).focus();
                            error_status = true;
                            return false;
                        }
                    }
                });
                if(!error_status){
                    form.submit();
                }
            });

            /* Active toggler from ticket cards function */
            $(document).on("change", "#ticketClient", function(){
                var project_id = $(this).val();
                $.ajax({
                    type : "POST",
                    url : "{{ route('ticket.create.project.change') }}",
                    data : {project_id},
                    success : function(response){
                        $('#ticketClientWrap').html(response);
                        $('.select2_select_option').select2();
                    }
                })
            });
            $(document).on("change", "#ticketTypeFilter", function(){
                var type = $(this).val();
                $.ajax({
                    type : "POST",
                    url : "{{ route('ticket.create.type.change') }}",
                    data : {type},
                    success : function(response){
                        $('#ticketProblemFilter').html(response);
                    }
                })
            });
            $(document).on("change", "#ticketType", function(){
                var type = $(this).val();
                $.ajax({
                    type : "POST",
                    url : "{{ route('ticket.create.type.change') }}",
                    data : {type},
                    success : function(response){
                        $('#ticketStatus').html(response);
                    }
                })
            });
            $(document).on("click", ".ticket-card", function(){
                $(".ticket-card").removeClass("active");
                $(this).addClass("active");
                var id = $(this).data('id');
                $(".ticket-card-list-wrapper").addClass("hide");
                $(".ticket-main-wrapper").addClass("show");
                $.ajax({
                    type : "POST",
                    url : "{{ route('ticket.sidebar.change') }}",
                    data : {
                        id : id
                    },
                    success : function(response){
                        $('#ticketMessageBody').html(response.data);
                        $('.select2_select_option').select2();
                        chatCardHeightMeasure();
                        $(".ticket-card-list-wrapper").attr({
                            style: `
                                --ticket-main-height: ${$('.ticket-main').outerHeight()}px;
                            `
                        });
                        $('[data-fancybox="gallery"]').fancybox({
                            buttons : [
                                'download',
                                'close'
                            ]
                        });
                        // tag_user_list = [];
                        // response.assigned_users.forEach(function(item){
                        //     tag_user_list.push({ id:item.id, value:item.name, title:item.name});
                        // });
                        tagifyInput();
                    }
                })
            });
            $(document).on("submit", "#ticketSendForm", function(e){
                e.preventDefault();
                $("#TicketMessageStoreModal").modal('hide');
                $.ajax({
                    type : "POST",
                    url : "{{ route('ticket.message.store') }}",
                    processData: false,
                    contentType: false,
                    data : new FormData($('#ticketSendForm')[0]),
                    success : function(response){
                        $('#ticketMessageBody').html(response);
                        $('.select2_select_option').select2();
                        chatCardHeightMeasure();
                        tagifyInput();
                        $('[data-fancybox="gallery"]').fancybox({
                            buttons : [
                                'download',
                                'close'
                            ]
                        });
                    },
                    error : function(err){
                        $('#errorMessage').text(err.responseJSON.errors['message']);
				        $('.toast.toast--error').toast('show');
                        $('body .ticket-main__chat-card__form__textarea').focus();
                    }
                })
            });

            $(document).on("submit", ".ticketAssignUpdateForm", function(e){
                e.preventDefault();
                $('body #assignAgentModal').modal('hide');
                $.ajax({
                    type : "POST",
                    url : "{{ route('ticket.assign.update') }}",
                    processData: false,
                    contentType: false,
                    data : new FormData($('.ticketAssignUpdateForm')[0]),
                    success : function(response){
                        $('#ticketMessageBody').html(response.data);
                        $('.select2_select_option').select2();
                        chatCardHeightMeasure();
                        // tag_user_list = [];
                        // response.assigned_users.forEach(function(item){
                        //     tag_user_list.push({ id:item.id, value:item.name, title:item.name});
                        // });
                        tagifyInput();
                        $('[data-fancybox="gallery"]').fancybox({
                            buttons : [
                                'download',
                                'close'
                            ]
                        });
                    }
                })
            });

            $(document).on("click", ".ticket-main__aside__open", function(){
                $(this).addClass("d-none");
                $(this).closest(".ticket-main").find(".ticket-main__aside").removeClass("d-none");
                $(this).closest(".ticket-main").find(".ticket-main__chat-card").addClass("overlay");
                chatCardHeightMeasure();
            });

            $(document).on("click", ".ticket-main__aside__close", function(){
                $(this).closest(".ticket-main__aside").addClass("d-none");
                $(this).closest(".ticket-main").find(".ticket-main__chat-card__header .ticket-main__aside__open").removeClass("d-none");
                $(this).closest(".ticket-main").find(".ticket-main__chat-card").removeClass("overlay");
            });


            /* Submit Comment with keyboard Enter Key function */
            $(document).on("keypress", ".ticket-main__chat-card__form__textarea", function (e) {
                if(e.which === 13 && !e.shiftKey && !e.altKey && !e.ctrlKey ) {
                    e.preventDefault();
                    $("#TicketMessageStoreModal").modal('show');
                }
            });

             /* Scroll to Bottom function */
            // $(".ticket-main__chat-card__body__scroller").animate({
            //     scrollTop: $('.ticket-main__chat-card__body__list').prop("scrollHeight")
            // }, 1000);

            $(document).on("click", ".ticket-main__close", function(){
                $(".ticket-card-list-wrapper").removeClass("hide");
                $(".ticket-main-wrapper").removeClass("show");
            });

            $('#ticketClient').change(function(e){
                var id = $(this).val();
                if(id != ''){
                $.ajaxSetup({
                    headers: {
                        'X-CSRF-TOKEN': $('meta[name="csrf-token"]').attr('content')
                    }
                });
                $.ajax({
                    type: "POST",
                    url:"{{ route('event.client.project') }}",
                    data: {
                        client_id	:id,
                    },

                    success: function(data){
                        $('#ticketProject').html(data);
                    },
                });
                }
            });

            $('#ticketStatus').change(function(){
                $('#ticketDeadline').val($(this).find(':selected').data('deadline'));
            });

            /* Ticket Card Search Function */
            $(".ticket-card-searchbar").on("input", function(){
                let searchValue = $(this).val().toLowerCase();
                $(".ticket-card-list__item").filter(function(){
                    $(this).toggle($(this).find(".ticket-card").text().toLowerCase().indexOf(searchValue) > -1)
                });
            });
            let ticket_status_filter = '';
            let ticket_type_filter = '';
            $(".ticketFilterbtn").on("click", function(){
                let finalText, searchValue = $(this).data('filter-type');
                if(searchValue == 'open' || searchValue == 'closed'){
                    if(ticket_type_filter != ''){
                        finalText = searchValue +' '+ ticket_type_filter;
                    }else{
                        finalText = searchValue;
                    }
                    $('.ticketFilterbtnType').removeClass('active');
                    $(this).addClass('active');
                }else if(searchValue == 'Administratif' || searchValue == 'Technique' || searchValue == 'Financier'){
                    if(ticket_status_filter != ''){
                        finalText = ticket_status_filter +' '+ searchValue;
                    }else{
                        finalText = searchValue;
                    }
                    $('.ticketFilterbtnStatus').removeClass('active');
                    $(this).addClass('active');
                }else{
                    finalText = searchValue;
                }
                $(".ticket-card-list__item").filter(function(){
                    $(this).toggle($(this).find(".ticket-card").data('filter-text').indexOf(finalText) > -1)
                });

                if(searchValue == 'open' || searchValue == 'closed'){
                     ticket_status_filter = searchValue;
                }else if(searchValue == 'Administratif' || searchValue == 'Technique' || searchValue == 'Financier'){
                     ticket_type_filter = searchValue;
                }else{
                     ticket_status_filter = '';
                     ticket_type_filter = '';
                }

                if(searchValue){
                    $('#resetButton').removeClass('d-none');
                }else{
                    $('.ticketFilterbtn').removeClass('active');
                    $('#resetButton').addClass('d-none');
                }
            });
        });
    </script>
@endpush
